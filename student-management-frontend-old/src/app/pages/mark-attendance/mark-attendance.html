<div class="form-container">
  <form [formGroup]="attendanceForm" (ngSubmit)="onSubmit()">
    <h2>Mark Attendance</h2>

    <div class="form-group">
      <label for="date">Date</label>
      <input id="date" type="date" formControlName="date">
    </div>

    <div class="form-group">
      <label for="timetable_entry">Select Class Session</label>
      <select id="timetable_entry" formControlName="timetable_entry" (change)="onSessionChange($event)">
        <option [ngValue]="null" disabled>-- Select a session --</option>
        <option *ngFor="let entry of timetableEntries" [value]="entry.id">
          {{ getCourseName(entry.course) }} | {{ entry.day_of_week }}: {{ entry.start_time.substring(0,5) }} - {{ entry.end_time.substring(0,5) }}
        </option>
      </select>
    </div>

    <div *ngIf="studentsForSession.length > 0" formArrayName="studentAttendance">
      <hr>
      <h3>Students</h3>
      <div *ngFor="let student of studentsForSession; let i = index" [formGroupName]="i" class="student-row">
        <span>{{ student.username }}</span>
        <div class="status-options">
          <label><input type="radio" formControlName="status" value="PRESENT"> Present</label>
          <label><input type="radio" formControlName="status" value="ABSENT"> Absent</label>
          <label><input type="radio" formControlName="status" value="LATE"> Late</label>
        </div>
      </div>
    </div>

    <button type="submit" [disabled]="!attendanceForm.valid">Submit Attendance</button>
  </form>
</div>